{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.genDts = void 0;\n\nvar flatten_1 = __importDefault(require(\"lodash/flatten\"));\n\nvar isArray_1 = __importDefault(require(\"lodash/isArray\"));\n\nvar map_1 = __importDefault(require(\"lodash/map\"));\n\nvar reduce_1 = __importDefault(require(\"lodash/reduce\"));\n\nvar uniq_1 = __importDefault(require(\"lodash/uniq\"));\n\nvar upperFirst_1 = __importDefault(require(\"lodash/upperFirst\"));\n\nfunction genDts(model, options) {\n  var contentParts = [];\n  contentParts = contentParts.concat(\"import type { CstNode, ICstVisitor, IToken } from \\\"chevrotain\\\";\");\n  contentParts = contentParts.concat((0, flatten_1.default)((0, map_1.default)(model, function (node) {\n    return genCstNodeTypes(node);\n  })));\n\n  if (options.includeVisitorInterface) {\n    contentParts = contentParts.concat(genVisitor(options.visitorInterfaceName, model));\n  }\n\n  return contentParts.join(\"\\n\\n\") + \"\\n\";\n}\n\nexports.genDts = genDts;\n\nfunction genCstNodeTypes(node) {\n  var nodeCstInterface = genNodeInterface(node);\n  var nodeChildrenInterface = genNodeChildrenType(node);\n  return [nodeCstInterface, nodeChildrenInterface];\n}\n\nfunction genNodeInterface(node) {\n  var nodeInterfaceName = getNodeInterfaceName(node.name);\n  var childrenTypeName = getNodeChildrenTypeName(node.name);\n  return \"export interface \".concat(nodeInterfaceName, \" extends CstNode {\\n  name: \\\"\").concat(node.name, \"\\\";\\n  children: \").concat(childrenTypeName, \";\\n}\");\n}\n\nfunction genNodeChildrenType(node) {\n  var typeName = getNodeChildrenTypeName(node.name);\n  return \"export type \".concat(typeName, \" = {\\n  \").concat((0, map_1.default)(node.properties, function (property) {\n    return genChildProperty(property);\n  }).join(\"\\n  \"), \"\\n};\");\n}\n\nfunction genChildProperty(prop) {\n  var typeName = buildTypeString(prop.type);\n  return \"\".concat(prop.name).concat(prop.optional ? \"?\" : \"\", \": \").concat(typeName, \"[];\");\n}\n\nfunction genVisitor(name, nodes) {\n  return \"export interface \".concat(name, \"<IN, OUT> extends ICstVisitor<IN, OUT> {\\n  \").concat((0, map_1.default)(nodes, function (node) {\n    return genVisitorFunction(node);\n  }).join(\"\\n  \"), \"\\n}\");\n}\n\nfunction genVisitorFunction(node) {\n  var childrenTypeName = getNodeChildrenTypeName(node.name);\n  return \"\".concat(node.name, \"(children: \").concat(childrenTypeName, \", param?: IN): OUT;\");\n}\n\nfunction buildTypeString(type) {\n  if ((0, isArray_1.default)(type)) {\n    var typeNames = (0, uniq_1.default)((0, map_1.default)(type, function (t) {\n      return getTypeString(t);\n    }));\n    var typeString = (0, reduce_1.default)(typeNames, function (sum, t) {\n      return sum + \" | \" + t;\n    });\n    return \"(\" + typeString + \")\";\n  } else {\n    return getTypeString(type);\n  }\n}\n\nfunction getTypeString(type) {\n  if (type.kind === \"token\") {\n    return \"IToken\";\n  }\n\n  return getNodeInterfaceName(type.name);\n}\n\nfunction getNodeInterfaceName(ruleName) {\n  return (0, upperFirst_1.default)(ruleName) + \"CstNode\";\n}\n\nfunction getNodeChildrenTypeName(ruleName) {\n  return (0, upperFirst_1.default)(ruleName) + \"CstChildren\";\n}","map":{"version":3,"mappings":"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","names":["genDts","model","options","contentParts","concat","node","includeVisitorInterface","genVisitor","visitorInterfaceName","join","exports","genCstNodeTypes","nodeCstInterface","genNodeInterface","nodeChildrenInterface","genNodeChildrenType","nodeInterfaceName","getNodeInterfaceName","name","childrenTypeName","getNodeChildrenTypeName","typeName","properties","property","genChildProperty","prop","buildTypeString","type","optional","nodes","genVisitorFunction","typeNames","t","typeString","sum","getTypeString","kind","ruleName"],"sourceRoot":"","sources":["../../src/generate.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}