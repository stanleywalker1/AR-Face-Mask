{"ast":null,"code":"\"use strict\";\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function () {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n\n  __setModuleDefault(result, mod);\n\n  return result;\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nconst ZapparThree = __importStar(require(\"@zappar/zappar-threejs\"));\n\nconst react_1 = __importStar(require(\"react\"));\n\nconst cameraTexture_1 = require(\"@zappar/zappar-threejs/lib/cameraTexture\");\n\nconst react_merge_refs_1 = __importDefault(require(\"react-merge-refs\"));\n\nconst fiber_1 = require(\"@react-three/fiber\");\n\nconst store_1 = __importDefault(require(\"../store\"));\n\nclass ZapparCameraAdditional extends ZapparThree.Camera {\n  constructor() {\n    super(...arguments);\n\n    this.updateProjectionMatrix = () => {};\n  }\n\n} // First frame rendered R3f tries to update the projection matrix of the default camera.\n// Zappar camera does not have this method, so we create a noop\n\n\n(0, fiber_1.extend)({\n  ZapparCameraAdditional\n});\n/**\n * Creates a camera that you can use instead of a perspective camera.\n *\n * @see https://docs.zap.works/universal-ar/web-libraries/react-threejs/camera-setup/\n */\n\nconst ZapparCamera = (0, react_1.forwardRef)((props, ref) => {\n  const {\n    userFacing = false,\n    rearCameraMirrorMode,\n    userCameraMirrorMode,\n    poseMode,\n    poseAnchorOrigin,\n    pipeline,\n    sources,\n    makeDefault = true,\n    renderPriority = 2,\n    environmentMap = false,\n    permissionRequest = true,\n    onFirstFrame,\n    backgroundImageProps\n  } = props;\n  const {\n    gl,\n    set\n  } = (0, fiber_1.useThree)(state => state);\n  const [hadFirstFrame, setHadFirstFrame] = (0, react_1.useState)(false);\n  const [cameraTexture] = (0, react_1.useState)(new cameraTexture_1.CameraTexture());\n  const cameraEnvMap = (0, react_1.useMemo)(() => {\n    return environmentMap ? new ZapparThree.CameraEnvironmentMap() : undefined;\n  }, [environmentMap]);\n  (0, react_1.useEffect)(() => {\n    if (backgroundImageProps && cameraTexture) Object.assign(cameraTexture, backgroundImageProps);\n  }, [backgroundImageProps, cameraTexture]);\n  const cameraRef = react_1.default.useRef();\n  const [permissionGranted, setPermissionGranted] = (0, react_1.useState)(false);\n  const store = {\n    camera: store_1.default.camera(state => state) // cameraEnvironmentMap: useStore.cameraEnvironmentMap((state) => state),\n\n  };\n  (0, react_1.useEffect)(() => {\n    const activePipeline = pipeline || ZapparThree;\n    activePipeline.glContextSet(gl.getContext());\n  }, [pipeline, gl]); // TODO: If not making default, scene's texture should not be changed, and camera should not tick.\n  // TODO: Instead, it should be exposed to user to set when needed.\n\n  (0, react_1.useEffect)(() => {\n    if (makeDefault) {\n      set(() => ({\n        camera: cameraRef.current\n      }));\n    }\n  }, [makeDefault]);\n  (0, react_1.useEffect)(() => {\n    if (!cameraRef.current) return;\n    store.camera.set(cameraRef.current);\n\n    if (permissionGranted || !permissionRequest) {\n      cameraRef.current.start(userFacing);\n    } else {\n      ZapparThree.permissionRequestUI().then(granted => {\n        setPermissionGranted(granted);\n        if (granted) cameraRef.current.start(userFacing);else ZapparThree.permissionDeniedUI();\n      });\n    }\n  }, [userFacing, permissionRequest]);\n  (0, react_1.useEffect)(() => {\n    if (!cameraRef.current) return;\n\n    switch (rearCameraMirrorMode) {\n      case \"poses\":\n        cameraRef.current.rearCameraMirrorMode = ZapparThree.CameraMirrorMode.Poses;\n        break;\n\n      case \"css\":\n        cameraRef.current.rearCameraMirrorMode = ZapparThree.CameraMirrorMode.CSS;\n        break;\n\n      case \"none\":\n      default:\n        cameraRef.current.rearCameraMirrorMode = ZapparThree.CameraMirrorMode.None;\n        break;\n    }\n\n    switch (userCameraMirrorMode) {\n      case \"none\":\n        cameraRef.current.userCameraMirrorMode = ZapparThree.CameraMirrorMode.None;\n        break;\n\n      case \"css\":\n        cameraRef.current.userCameraMirrorMode = ZapparThree.CameraMirrorMode.CSS;\n        break;\n\n      case \"poses\":\n      default:\n        cameraRef.current.userCameraMirrorMode = ZapparThree.CameraMirrorMode.Poses;\n        break;\n    }\n\n    switch (poseMode) {\n      case \"anchor-origin\":\n        cameraRef.current.poseMode = ZapparThree.CameraPoseMode.AnchorOrigin;\n        cameraRef.current.poseAnchorOrigin = poseAnchorOrigin;\n        break;\n\n      case \"attitude\":\n        cameraRef.current.poseMode = ZapparThree.CameraPoseMode.Attitude;\n        break;\n\n      case \"default\":\n      default:\n        cameraRef.current.poseMode = ZapparThree.CameraPoseMode.Default;\n        break;\n    }\n  }, [rearCameraMirrorMode, userCameraMirrorMode, poseMode, poseAnchorOrigin]);\n  (0, fiber_1.useFrame)(_ref => {\n    let {\n      gl,\n      scene\n    } = _ref;\n    if (!cameraRef.current) return;\n\n    if (onFirstFrame && !hadFirstFrame && cameraRef.current.pipeline.frameNumber() > 0) {\n      setHadFirstFrame(true);\n      onFirstFrame();\n    } // store.cameraEnvironmentMap.object?.update(gl, cameraRef.current);\n\n\n    cameraEnvMap === null || cameraEnvMap === void 0 ? void 0 : cameraEnvMap.update(gl, cameraRef.current); // eslint-disable-next-line no-param-reassign\n\n    cameraRef.current.updateFrame(gl);\n    gl.render(scene, cameraRef.current);\n  }, renderPriority); // eslint-disable-next-line no-underscore-dangle\n\n  if (cameraRef.current) cameraRef.current.__r3f.primitive = true;\n  return react_1.default.createElement(react_1.default.Fragment, null, react_1.default.createElement(\"primitive\", {\n    object: cameraTexture,\n    attach: \"background\"\n  }), environmentMap && react_1.default.createElement(\"primitive\", {\n    object: cameraEnvMap.environmentMap,\n    attach: \"environment\"\n  }), react_1.default.createElement(\"zapparCameraAdditional\", Object.assign({\n    args: [{\n      pipeline,\n      userCameraSource: sources === null || sources === void 0 ? void 0 : sources.userCamera,\n      rearCameraSource: sources === null || sources === void 0 ? void 0 : sources.rearCamera,\n      backgroundTexture: cameraTexture\n    }],\n    ref: (0, react_merge_refs_1.default)([cameraRef, ref])\n  }, props)));\n});\nexports.default = ZapparCamera;","map":{"version":3,"sources":["/Users/StanleyWalker/Desktop/face-mask-demo/AR-Face-Mask/node_modules/@zappar/zappar-react-three-fiber/lib/Components/ZapparCamera.js"],"names":["__createBinding","Object","create","o","m","k","k2","undefined","defineProperty","enumerable","get","__setModuleDefault","v","value","__importStar","mod","__esModule","result","prototype","hasOwnProperty","call","__importDefault","exports","ZapparThree","require","react_1","cameraTexture_1","react_merge_refs_1","fiber_1","store_1","ZapparCameraAdditional","Camera","constructor","arguments","updateProjectionMatrix","extend","ZapparCamera","forwardRef","props","ref","userFacing","rearCameraMirrorMode","userCameraMirrorMode","poseMode","poseAnchorOrigin","pipeline","sources","makeDefault","renderPriority","environmentMap","permissionRequest","onFirstFrame","backgroundImageProps","gl","set","useThree","state","hadFirstFrame","setHadFirstFrame","useState","cameraTexture","CameraTexture","cameraEnvMap","useMemo","CameraEnvironmentMap","useEffect","assign","cameraRef","default","useRef","permissionGranted","setPermissionGranted","store","camera","activePipeline","glContextSet","getContext","current","start","permissionRequestUI","then","granted","permissionDeniedUI","CameraMirrorMode","Poses","CSS","None","CameraPoseMode","AnchorOrigin","Attitude","Default","useFrame","scene","frameNumber","update","updateFrame","render","__r3f","primitive","createElement","Fragment","object","attach","args","userCameraSource","userCamera","rearCameraSource","rearCamera","backgroundTexture"],"mappings":"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","sourcesContent":["\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst ZapparThree = __importStar(require(\"@zappar/zappar-threejs\"));\nconst react_1 = __importStar(require(\"react\"));\nconst cameraTexture_1 = require(\"@zappar/zappar-threejs/lib/cameraTexture\");\nconst react_merge_refs_1 = __importDefault(require(\"react-merge-refs\"));\nconst fiber_1 = require(\"@react-three/fiber\");\nconst store_1 = __importDefault(require(\"../store\"));\nclass ZapparCameraAdditional extends ZapparThree.Camera {\n    constructor() {\n        super(...arguments);\n        this.updateProjectionMatrix = () => { };\n    }\n}\n// First frame rendered R3f tries to update the projection matrix of the default camera.\n// Zappar camera does not have this method, so we create a noop\n(0, fiber_1.extend)({ ZapparCameraAdditional });\n/**\n * Creates a camera that you can use instead of a perspective camera.\n *\n * @see https://docs.zap.works/universal-ar/web-libraries/react-threejs/camera-setup/\n */\nconst ZapparCamera = (0, react_1.forwardRef)((props, ref) => {\n    const { userFacing = false, rearCameraMirrorMode, userCameraMirrorMode, poseMode, poseAnchorOrigin, pipeline, sources, makeDefault = true, renderPriority = 2, environmentMap = false, permissionRequest = true, onFirstFrame, backgroundImageProps, } = props;\n    const { gl, set } = (0, fiber_1.useThree)((state) => state);\n    const [hadFirstFrame, setHadFirstFrame] = (0, react_1.useState)(false);\n    const [cameraTexture] = (0, react_1.useState)(new cameraTexture_1.CameraTexture());\n    const cameraEnvMap = (0, react_1.useMemo)(() => {\n        return environmentMap ? new ZapparThree.CameraEnvironmentMap() : undefined;\n    }, [environmentMap]);\n    (0, react_1.useEffect)(() => {\n        if (backgroundImageProps && cameraTexture)\n            Object.assign(cameraTexture, backgroundImageProps);\n    }, [backgroundImageProps, cameraTexture]);\n    const cameraRef = react_1.default.useRef();\n    const [permissionGranted, setPermissionGranted] = (0, react_1.useState)(false);\n    const store = {\n        camera: store_1.default.camera((state) => state),\n        // cameraEnvironmentMap: useStore.cameraEnvironmentMap((state) => state),\n    };\n    (0, react_1.useEffect)(() => {\n        const activePipeline = pipeline || ZapparThree;\n        activePipeline.glContextSet(gl.getContext());\n    }, [pipeline, gl]);\n    // TODO: If not making default, scene's texture should not be changed, and camera should not tick.\n    // TODO: Instead, it should be exposed to user to set when needed.\n    (0, react_1.useEffect)(() => {\n        if (makeDefault) {\n            set(() => ({ camera: cameraRef.current }));\n        }\n    }, [makeDefault]);\n    (0, react_1.useEffect)(() => {\n        if (!cameraRef.current)\n            return;\n        store.camera.set(cameraRef.current);\n        if (permissionGranted || !permissionRequest) {\n            cameraRef.current.start(userFacing);\n        }\n        else {\n            ZapparThree.permissionRequestUI().then((granted) => {\n                setPermissionGranted(granted);\n                if (granted)\n                    cameraRef.current.start(userFacing);\n                else\n                    ZapparThree.permissionDeniedUI();\n            });\n        }\n    }, [userFacing, permissionRequest]);\n    (0, react_1.useEffect)(() => {\n        if (!cameraRef.current)\n            return;\n        switch (rearCameraMirrorMode) {\n            case \"poses\":\n                cameraRef.current.rearCameraMirrorMode = ZapparThree.CameraMirrorMode.Poses;\n                break;\n            case \"css\":\n                cameraRef.current.rearCameraMirrorMode = ZapparThree.CameraMirrorMode.CSS;\n                break;\n            case \"none\":\n            default:\n                cameraRef.current.rearCameraMirrorMode = ZapparThree.CameraMirrorMode.None;\n                break;\n        }\n        switch (userCameraMirrorMode) {\n            case \"none\":\n                cameraRef.current.userCameraMirrorMode = ZapparThree.CameraMirrorMode.None;\n                break;\n            case \"css\":\n                cameraRef.current.userCameraMirrorMode = ZapparThree.CameraMirrorMode.CSS;\n                break;\n            case \"poses\":\n            default:\n                cameraRef.current.userCameraMirrorMode = ZapparThree.CameraMirrorMode.Poses;\n                break;\n        }\n        switch (poseMode) {\n            case \"anchor-origin\":\n                cameraRef.current.poseMode = ZapparThree.CameraPoseMode.AnchorOrigin;\n                cameraRef.current.poseAnchorOrigin = poseAnchorOrigin;\n                break;\n            case \"attitude\":\n                cameraRef.current.poseMode = ZapparThree.CameraPoseMode.Attitude;\n                break;\n            case \"default\":\n            default:\n                cameraRef.current.poseMode = ZapparThree.CameraPoseMode.Default;\n                break;\n        }\n    }, [rearCameraMirrorMode, userCameraMirrorMode, poseMode, poseAnchorOrigin]);\n    (0, fiber_1.useFrame)(({ gl, scene }) => {\n        if (!cameraRef.current)\n            return;\n        if (onFirstFrame && !hadFirstFrame && cameraRef.current.pipeline.frameNumber() > 0) {\n            setHadFirstFrame(true);\n            onFirstFrame();\n        }\n        // store.cameraEnvironmentMap.object?.update(gl, cameraRef.current);\n        cameraEnvMap === null || cameraEnvMap === void 0 ? void 0 : cameraEnvMap.update(gl, cameraRef.current);\n        // eslint-disable-next-line no-param-reassign\n        cameraRef.current.updateFrame(gl);\n        gl.render(scene, cameraRef.current);\n    }, renderPriority);\n    // eslint-disable-next-line no-underscore-dangle\n    if (cameraRef.current)\n        cameraRef.current.__r3f.primitive = true;\n    return (react_1.default.createElement(react_1.default.Fragment, null,\n        react_1.default.createElement(\"primitive\", { object: cameraTexture, attach: \"background\" }),\n        environmentMap && react_1.default.createElement(\"primitive\", { object: cameraEnvMap.environmentMap, attach: \"environment\" }),\n        react_1.default.createElement(\"zapparCameraAdditional\", Object.assign({ args: [{ pipeline, userCameraSource: sources === null || sources === void 0 ? void 0 : sources.userCamera, rearCameraSource: sources === null || sources === void 0 ? void 0 : sources.rearCamera, backgroundTexture: cameraTexture }], ref: (0, react_merge_refs_1.default)([cameraRef, ref]) }, props))));\n});\nexports.default = ZapparCamera;\n"]},"metadata":{},"sourceType":"script"}