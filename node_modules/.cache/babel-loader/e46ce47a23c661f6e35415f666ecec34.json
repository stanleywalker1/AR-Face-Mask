{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.buildModel = void 0;\n\nvar gast_1 = require(\"@chevrotain/gast\");\n\nvar map_1 = __importDefault(require(\"lodash/map\"));\n\nvar flatten_1 = __importDefault(require(\"lodash/flatten\"));\n\nvar values_1 = __importDefault(require(\"lodash/values\"));\n\nvar some_1 = __importDefault(require(\"lodash/some\"));\n\nvar groupBy_1 = __importDefault(require(\"lodash/groupBy\"));\n\nvar assign_1 = __importDefault(require(\"lodash/assign\"));\n\nfunction buildModel(productions) {\n  var generator = new CstNodeDefinitionGenerator();\n  var allRules = (0, values_1.default)(productions);\n  return (0, map_1.default)(allRules, function (rule) {\n    return generator.visitRule(rule);\n  });\n}\n\nexports.buildModel = buildModel;\n\nvar CstNodeDefinitionGenerator =\n/** @class */\nfunction (_super) {\n  __extends(CstNodeDefinitionGenerator, _super);\n\n  function CstNodeDefinitionGenerator() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  CstNodeDefinitionGenerator.prototype.visitRule = function (node) {\n    var rawElements = this.visitEach(node.definition);\n    var grouped = (0, groupBy_1.default)(rawElements, function (el) {\n      return el.propertyName;\n    });\n    var properties = (0, map_1.default)(grouped, function (group, propertyName) {\n      var allNullable = !(0, some_1.default)(group, function (el) {\n        return !el.canBeNull;\n      }); // In an alternation with a label a property name can have\n      // multiple types.\n\n      var propertyType = group[0].type;\n\n      if (group.length > 1) {\n        propertyType = (0, map_1.default)(group, function (g) {\n          return g.type;\n        });\n      }\n\n      return {\n        name: propertyName,\n        type: propertyType,\n        optional: allNullable\n      };\n    });\n    return {\n      name: node.name,\n      properties: properties\n    };\n  };\n\n  CstNodeDefinitionGenerator.prototype.visitAlternative = function (node) {\n    return this.visitEachAndOverrideWith(node.definition, {\n      canBeNull: true\n    });\n  };\n\n  CstNodeDefinitionGenerator.prototype.visitOption = function (node) {\n    return this.visitEachAndOverrideWith(node.definition, {\n      canBeNull: true\n    });\n  };\n\n  CstNodeDefinitionGenerator.prototype.visitRepetition = function (node) {\n    return this.visitEachAndOverrideWith(node.definition, {\n      canBeNull: true\n    });\n  };\n\n  CstNodeDefinitionGenerator.prototype.visitRepetitionMandatory = function (node) {\n    return this.visitEach(node.definition);\n  };\n\n  CstNodeDefinitionGenerator.prototype.visitRepetitionMandatoryWithSeparator = function (node) {\n    return this.visitEach(node.definition).concat({\n      propertyName: node.separator.name,\n      canBeNull: true,\n      type: getType(node.separator)\n    });\n  };\n\n  CstNodeDefinitionGenerator.prototype.visitRepetitionWithSeparator = function (node) {\n    return this.visitEachAndOverrideWith(node.definition, {\n      canBeNull: true\n    }).concat({\n      propertyName: node.separator.name,\n      canBeNull: true,\n      type: getType(node.separator)\n    });\n  };\n\n  CstNodeDefinitionGenerator.prototype.visitAlternation = function (node) {\n    return this.visitEachAndOverrideWith(node.definition, {\n      canBeNull: true\n    });\n  };\n\n  CstNodeDefinitionGenerator.prototype.visitTerminal = function (node) {\n    return [{\n      propertyName: node.label || node.terminalType.name,\n      canBeNull: false,\n      type: getType(node)\n    }];\n  };\n\n  CstNodeDefinitionGenerator.prototype.visitNonTerminal = function (node) {\n    return [{\n      propertyName: node.label || node.nonTerminalName,\n      canBeNull: false,\n      type: getType(node)\n    }];\n  };\n\n  CstNodeDefinitionGenerator.prototype.visitEachAndOverrideWith = function (definition, override) {\n    return (0, map_1.default)(this.visitEach(definition), function (definition) {\n      return (0, assign_1.default)({}, definition, override);\n    });\n  };\n\n  CstNodeDefinitionGenerator.prototype.visitEach = function (definition) {\n    var _this = this;\n\n    return (0, flatten_1.default)((0, map_1.default)(definition, function (definition) {\n      return _this.visit(definition);\n    }));\n  };\n\n  return CstNodeDefinitionGenerator;\n}(gast_1.GAstVisitor);\n\nfunction getType(production) {\n  if (production instanceof gast_1.NonTerminal) {\n    return {\n      kind: \"rule\",\n      name: production.referencedRule.name\n    };\n  }\n\n  return {\n    kind: \"token\"\n  };\n}","map":{"version":3,"mappings":"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","names":["buildModel","productions","generator","CstNodeDefinitionGenerator","allRules","rule","visitRule","exports","__extends","node","rawElements","visitEach","definition","grouped","el","propertyName","properties","group","allNullable","canBeNull","propertyType","type","length","g","name","optional","visitEachAndOverrideWith","concat","separator","getType","label","terminalType","nonTerminalName","override","visit","gast_1","production","kind","referencedRule"],"sourceRoot":"","sources":["../../src/model.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}