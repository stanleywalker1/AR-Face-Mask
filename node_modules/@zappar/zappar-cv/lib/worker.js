"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const worker_server_1 = require("./worker-server");
const ctx = self;
worker_server_1.messageManager.onOutgoingMessage.bind(() => {
    let msgs = worker_server_1.messageManager.getOutgoingMessages();
    for (let msg of msgs) {
        ctx.postMessage(msg.msg, msg.transferables);
    }
});
let launchHandler = (evt) => {
    if (evt && evt.data && evt.data.t === "wasm") {
        let url = location.href.startsWith("blob") ? evt.data.url : require("./zcv.wasm");
        if (url.default)
            url = url.default;
        worker_server_1.launchWorkerServer(url);
        ctx.removeEventListener("message", launchHandler);
    }
};
ctx.addEventListener("message", launchHandler);
ctx.addEventListener("message", evt => {
    worker_server_1.messageManager.postIncomingMessage(evt.data);
});
